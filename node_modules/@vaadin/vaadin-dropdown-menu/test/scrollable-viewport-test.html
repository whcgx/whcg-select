<!doctype html>

<head>
  <meta charset="UTF-8">
  <title>vaadin-dropdown-menu tests</title>
  <script src="../../../wct-browser-legacy/browser.js"></script>
  <script src="../../../@polymer/iron-test-helpers/mock-interactions.js" type="module"></script>
  <script src="../../../@webcomponents/webcomponentsjs/webcomponents-lite.js"></script>
  <script type="module" src="../../../@polymer/test-fixture/test-fixture.js"></script>
  <script type="module" src="../../../@vaadin/vaadin-list-box/vaadin-list-box.js"></script>
  <script type="module" src="../../../@vaadin/vaadin-item/vaadin-item.js"></script>
  <script type="module" src="../vaadin-dropdown-menu.js"></script>
</head>

<body>
  <test-fixture id="dropdown">
    <style>
      #scrollable-container {
        width: 300px;
        height: 300px;
        overflow: scroll;
      }

      #container {
        height: 400px;
        width: 400px;
        padding-left: 50px;
        padding-top: 50px;
      }
    </style>
    <template>
      <div id="scrollable-container">
        <div id="container">
          <vaadin-dropdown-menu>
            <template>
              <vaadin-list-box>
                <vaadin-item>Option 1</vaadin-item>
                <vaadin-item>Option 2</vaadin-item>
                <vaadin-item>Option 3</vaadin-item>
              </vaadin-list-box>
            </template>
          </vaadin-dropdown-menu>
        </div>
      </div>
    </template>
  </test-fixture>

  <script type="module">
import '@polymer/test-fixture/test-fixture.js';
import '@vaadin/vaadin-list-box/vaadin-list-box.js';
import '@vaadin/vaadin-item/vaadin-item.js';
import '../vaadin-dropdown-menu.js';
function Enter(target) {
  MockInteractions.keyDownOn(target, 13, [], 'Enter');
}

describe('scrollable-viewport', () => {
  var scrollableContainer, container, dropdown, input;

  beforeEach(done => {
    scrollableContainer = fixture('dropdown');
    container = scrollableContainer.querySelector('[id="container"]');
    dropdown = container.querySelector('vaadin-dropdown-menu');
    input = dropdown._inputElement;
    flush(done);
  });

  it('should update the position on scrolling', () => {
    Enter(input);
    expect(dropdown._overlayElement.getBoundingClientRect().top).to.be.equal(input.getBoundingClientRect().top);
    expect(dropdown._overlayElement.getBoundingClientRect().left).to.be.equal(input.getBoundingClientRect().left);

    scrollableContainer.scrollTop = 40;
    scrollableContainer.scrollLeft = 40;

    window.dispatchEvent(new CustomEvent('scroll', {bubbles: true}));

    expect(dropdown._overlayElement.getBoundingClientRect().top).to.be.equal(input.getBoundingClientRect().top);
    expect(dropdown._overlayElement.getBoundingClientRect().left).to.be.equal(input.getBoundingClientRect().left);
  });

  it('should update the position on iron-resize event', () => {
    Enter(input);
    expect(dropdown._overlayElement.getBoundingClientRect().top).to.be.equal(input.getBoundingClientRect().top);
    expect(dropdown._overlayElement.getBoundingClientRect().left).to.be.equal(input.getBoundingClientRect().left);

    container.style.paddingTop = '200px';
    dropdown.dispatchEvent(new CustomEvent('iron-resize', {bubbles: true}));

    expect(dropdown._overlayElement.getBoundingClientRect().top).to.be.equal(input.getBoundingClientRect().top);
    expect(dropdown._overlayElement.getBoundingClientRect().left).to.be.equal(input.getBoundingClientRect().left);
  });
});
</script>
</body>
